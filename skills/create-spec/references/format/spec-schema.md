# Spec Schema

Canonical structure for `spec.yaml`. All placeholders - derive actual values from blueprint context.

## Structure

```yaml
# Technical Specification
# Generated by /opensdd:create-spec

tech_stack:
  language: {language}
  framework: {framework}
  database: {database}

deployment:
  model: {monolith|microservices}
  target: {docker|kubernetes|native}

conventions:
  type_case: {value}
  function_case: {value}
  module_case: {value}
  constant_case: {value}
  error_handling: {value}
  visibility: {value}
  file_naming: {value}

structure:
  root: {source_root}
  layout: {by_layer|by_feature|flat|monorepo}
  pattern: {folder|single_file|file_per_type}
  layers:
    {layer_name}: {path}
  components:
    {component_name}: {path}
  types:
    {category}: {path}
  shared: {path}
  tests: {path}
  configs: {path}
  entrypoints:
    {name}: {path}

types:
  {TypeName}:
    for: "{purpose}"
    used:
      - {component}.{function}

components:
  {component_name}:
    for: "{responsibility}"
    layer: {domain|application|infrastructure}
    provides:
      - {function_name}:
          for: "{purpose}"
          input: {InputType}
          output: {OutputType} | {ErrorType}
    emits:
      - {EventName}:
          for: "{when emitted}"
          payload: {PayloadType}
    subscribes:
      - {EventName}: "{action taken}"
    consumes:
      - {other_component}
    owns_data:
      - {Type}

architecture:
  global_patterns:
    dependency_injection:
      approach: {constructor|interface|container}
      for: "{rationale}"
    error_handling:
      approach: {result_types|exceptions|error_codes}
      for: "{rationale}"
    async:
      approach: {async_await|channels|actors|sync}
      for: "{rationale}"
  component_patterns:
    {component_name}:
      pattern: {strategy|factory|state_machine|repository|observer|decorator}
      for: "{rationale}"

integrations:
  - name: {external_system}
    for: "{purpose}"
    direction: {inbound|outbound|bidirectional}
    consumed_by:
      - {component}

boundaries:
  error_handling: "{strategy}"
  security: "{strategy}"
  events: "{strategy}"
```

## Section Reference

| Section | Phase | Description |
|---------|-------|-------------|
| tech_stack | 1 | Language, framework, database choices |
| deployment | 1 | Deployment model and target |
| conventions | 1 | Language-specific naming conventions |
| structure | 1 | Project layout and paths |
| types | 2 | All types with purpose and usage tracking |
| components | 3 | Component contracts (provides, emits, subscribes, consumes, owns_data) |
| architecture | 1 | Global and component-specific patterns |
| integrations | 4 | External system connections |
| boundaries | 4 | Cross-cutting concerns |

## Type Categories

Types are grouped by role (for organization, not in YAML structure):

| Category | Role | Naming Pattern |
|----------|------|----------------|
| Domain | Core business entities, value objects | `{Entity}`, `{Entity}Id` |
| Input | Data received by functions | `{Action}Input`, `{Action}Request` |
| Output | Data returned by functions | `{Action}Result`, `{Action}Response` |
| Error | Failure cases | `{Entity}NotFound`, `{Action}Failed` |
| Event | Async notifications | `{Entity}{Action}` (past tense: Created, Updated, Deleted) |

## Component Contract Elements

| Element | Question to Derive |
|---------|-------------------|
| `for` | What is this component's single responsibility? |
| `layer` | Is this domain logic, orchestration, or external concern? |
| `provides` | What operations does this component expose? |
| `emits` | What state changes should others know about? |
| `subscribes` | What events from others does this react to? |
| `consumes` | What other components does this depend on? |
| `owns_data` | What types is this the source of truth for? |
